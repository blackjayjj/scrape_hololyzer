name: Daily Deno Scraper

# This workflow is triggered on a daily schedule and manually via the GitHub Actions UI.
on:
  # Schedule: Runs every day at 00:00 UTC (Midnight UTC). 
  # You can adjust the cron string if you need a different time.
  schedule:
    # Syntax: minute hour day_of_month month day_of_week
    - cron: '0 0 * * *'
  
  # Allows for manual triggering of the workflow from the Actions tab
  workflow_dispatch:

jobs:
  run_deno_script:
    runs-on: ubuntu-latest
    
    # Define the custom path for the entire job.
    env:
      PLAYWRIGHT_BROWSERS_PATH: ${{ github.workspace }}/.playwright-browsers

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Deno (v2.x)
        uses: denoland/setup-deno@v1
        with:
          deno-version: v2.x

      - name: Install Playwright Browsers
        run: deno run --allow-run npm:playwright@latest install chromium

      - name: Run Scraper Script
        run: deno run --allow-all main.ts
        env:
          PLAYWRIGHT_BROWSERS_PATH: ${{ github.workspace }}/.playwright-browsers
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SECRET_KEY: ${{ secrets.SUPABASE_SECRET_KEY }}